generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Company {
  id                     String                    @id @default(uuid())
  name                   String
  website                String
  domain                 String                    @unique
  countryOrRegion        String                    @default("") @map("country_or_region")
  acceptedTerms          Boolean                   @default(false) @map("accepted_terms")
  verificationStatus     CompanyVerificationStatus @default(PENDING)
  verificationMethod     VerificationMethod?
  verifiedAt             DateTime?
  verifiedBy             String?
  gstNumber              String?
  registrationNumber     String?
  linkedInUrl            String?
  createdAt              DateTime                  @default(now())
  updatedAt              DateTime                  @updatedAt
  regionId               String?                   @map("region_id")
  job_assignment_mode    JobAssignmentMode         @default(AUTO_RULES_ONLY)
  preferred_recruiter_id String?
  region                 Region?                   @relation(fields: [regionId], references: [id])
  profile                CompanyProfile?
  CompanySettings        CompanySettings?
  invitations            Invitation[]
  jobs                   Job[]
  JobTemplate            JobTemplate[]
  signupRequests         SignupRequest[]
  users                  User[]
  verificationTokens     VerificationToken[]

  @@index([domain])
  @@index([verificationStatus])
  @@index([regionId])
}

model CompanyProfile {
  id                   String                  @id @default(uuid())
  companyId            String                  @unique @map("company_id")
  status               CompanyProfileStatus    @default(NOT_STARTED)
  completionPercentage Int                     @default(0) @map("completion_percentage")
  completedSections    CompanyProfileSection[] @default([]) @map("completed_sections")
  profileData          Json?                   @map("profile_data")
  lastReminderAt       DateTime?               @map("last_reminder_at")
  skipUntil            DateTime?               @map("skip_until")
  createdAt            DateTime                @default(now()) @map("created_at")
  updatedAt            DateTime                @updatedAt @map("updated_at")
  company              Company                 @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([companyId])
}

model User {
  id                     String               @id @default(uuid())
  email                  String               @unique
  name                   String
  passwordHash           String               @map("password_hash")
  companyId              String               @map("company_id")
  role                   UserRole
  status                 UserStatus           @default(PENDING_VERIFICATION)
  lastLoginAt            DateTime?            @map("last_login_at")
  createdAt              DateTime             @default(now()) @map("created_at")
  updatedAt              DateTime             @updatedAt @map("updated_at")
  assignedBy             String?              @map("assigned_by")
  Assessment             Assessment[]
  sentInvitations        Invitation[]         @relation("InvitedBy")
  createdJobs            Job[]                @relation("JobCreator")
  sentJobInvitations     JobInvitation[]      @relation("JobInviter")
  JobTemplate            JobTemplate[]
  passwordResetTokens    PasswordResetToken[]
  ScreeningResult        ScreeningResult[]
  sessions               Session[]
  reviewedSignupRequests SignupRequest[]      @relation("ReviewedBy")
  roleAssigner           User?                @relation("RoleAssigner", fields: [assignedBy], references: [id])
  assignedUsers          User[]               @relation("RoleAssigner")
  company                Company              @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([email])
  @@index([companyId])
  @@index([status])
  @@index([role])
}

model Invitation {
  id         String           @id @default(uuid())
  companyId  String           @map("company_id")
  invitedBy  String           @map("invited_by")
  email      String
  token      String           @unique
  status     InvitationStatus @default(PENDING)
  expiresAt  DateTime         @map("expires_at")
  acceptedAt DateTime?        @map("accepted_at")
  createdAt  DateTime         @default(now()) @map("created_at")
  company    Company          @relation(fields: [companyId], references: [id], onDelete: Cascade)
  inviter    User             @relation("InvitedBy", fields: [invitedBy], references: [id], onDelete: Cascade)

  @@index([email])
  @@index([companyId])
  @@index([token])
  @@index([status])
  @@index([expiresAt])
}

model Session {
  id           String   @id @default(uuid())
  sessionId    String   @unique @map("session_id")
  userId       String   @map("user_id")
  companyId    String   @map("company_id")
  userRole     UserRole @map("user_role")
  email        String
  expiresAt    DateTime @map("expires_at")
  lastActivity DateTime @default(now()) @map("last_activity")
  createdAt    DateTime @default(now()) @map("created_at")
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([sessionId])
  @@index([userId])
  @@index([companyId])
  @@index([expiresAt])
}

model PasswordResetToken {
  id                 String    @id @default(uuid())
  userId             String    @map("user_id")
  tokenHash          String    @unique @map("token_hash")
  expiresAt          DateTime  @map("expires_at")
  usedAt             DateTime? @map("used_at")
  requestedIp        String?   @map("requested_ip")
  requestedUserAgent String?   @map("requested_user_agent")
  createdAt          DateTime  @default(now()) @map("created_at")
  user               User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([expiresAt])
  @@index([tokenHash])
}

model VerificationToken {
  id        String    @id @default(uuid())
  companyId String    @map("company_id")
  email     String
  token     String    @unique
  expiresAt DateTime  @map("expires_at")
  usedAt    DateTime? @map("used_at")
  createdAt DateTime  @default(now()) @map("created_at")
  company   Company   @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@index([email])
  @@index([token])
  @@index([expiresAt])
}

model SignupRequest {
  id              String              @id @default(uuid())
  companyId       String              @map("company_id")
  email           String
  name            String
  firstName       String              @default("") @map("first_name")
  lastName        String              @default("") @map("last_name")
  acceptedTerms   Boolean             @default(false) @map("accepted_terms")
  passwordHash    String              @map("password_hash")
  status          SignupRequestStatus @default(PENDING)
  reviewedBy      String?             @map("reviewed_by")
  reviewedAt      DateTime?           @map("reviewed_at")
  rejectionReason String?             @map("rejection_reason")
  createdAt       DateTime            @default(now()) @map("created_at")
  updatedAt       DateTime            @updatedAt @map("updated_at")
  company         Company             @relation(fields: [companyId], references: [id], onDelete: Cascade)
  reviewer        User?               @relation("ReviewedBy", fields: [reviewedBy], references: [id])

  @@index([email])
  @@index([companyId])
  @@index([status])
  @@index([createdAt])
}

model Job {
  id                                  String                      @id @default(uuid())
  companyId                           String                      @map("company_id")
  createdBy                           String                      @map("created_by")
  title                               String
  jobCode                             String?                     @map("job_code")
  jobSummary                          String?                     @map("job_summary") @db.VarChar(150)
  category                            String?
  numberOfVacancies                   Int                         @default(1) @map("number_of_vacancies")
  department                          String?
  location                            String
  employmentType                      EmploymentType              @default(FULL_TIME) @map("employment_type")
  workArrangement                     WorkArrangement             @default(ON_SITE) @map("work_arrangement")
  salaryMin                           Float?                      @map("salary_min")
  salaryMax                           Float?                      @map("salary_max")
  salaryCurrency                      String                      @default("USD") @map("salary_currency")
  salaryDescription                   String?                     @map("salary_description")
  description                         String
  status                              JobStatus                   @default(DRAFT)
  stealth                             Boolean                     @default(false)
  postingDate                         DateTime?                   @map("posting_date")
  closeDate                           DateTime?                   @map("close_date")
  createdAt                           DateTime                    @default(now()) @map("created_at")
  updatedAt                           DateTime                    @updatedAt @map("updated_at")
  expiryDate                          DateTime?                   @map("expiry_date")
  featured                            Boolean                     @default(false)
  hiringMode                          HiringMode                  @default(SELF_MANAGED) @map("hiring_mode")
  promotionalTags                     String[]                    @default([]) @map("promotional_tags")
  visibility                          String                      @default("public")
  requirements                        String[]                    @default([])
  responsibilities                    String[]                    @default([])
  termsAccepted                       Boolean                     @default(false) @map("terms_accepted")
  termsAcceptedAt                     DateTime?                   @map("terms_accepted_at")
  termsAcceptedBy                     String?                     @map("terms_accepted_by")
  hiringTeam                          Json?                       @map("hiring_team")
  applicationForm                     Json?                       @map("application_form")
  videoInterviewingEnabled            Boolean                     @default(false) @map("video_interviewing_enabled")
  alertsEnabled                       Json?                       @map("alerts_enabled")
  jobTargetApproved                   Boolean                     @default(false) @map("jobtarget_approved")
  jobTargetBudget                     Float?                      @map("jobtarget_budget")
  jobTargetBudgetSpent                Float?                      @default(0) @map("jobtarget_budget_spent")
  jobTargetChannels                   String[]                    @default([]) @map("jobtarget_channels")
  jobTargetPromotionId                String?                     @map("jobtarget_promotion_id")
  jobTargetStatus                     String?                     @map("jobtarget_status")
  referralLink                        String?                     @map("referral_link")
  savedAsTemplate                     Boolean                     @default(false) @map("saved_as_template")
  shareLink                           String?                     @map("share_link")
  templateId                          String?                     @map("template_id")
  archived                            Boolean                     @default(false) @map("archived")
  archivedAt                          DateTime?                   @map("archived_at")
  archivedBy                          String?                     @map("archived_by")
  automated_screening_enabled         Boolean                     @default(false)
  pre_interview_questionnaire_enabled Boolean                     @default(false)
  screening_criteria                  Json?
  screening_enabled                   Boolean                     @default(false)
  regionId                            String?                     @map("region_id")
  assigned_consultant_id              String?
  assignment_mode                     AssignmentMode              @default(AUTO)
  assignment_source                   AssignmentSource?
  applications                        Application[]
  commissions                         Commission[]
  consultantAssignments               ConsultantJobAssignment[]
  Consultant                          Consultant?                 @relation(fields: [assigned_consultant_id], references: [id])
  company                             Company                     @relation(fields: [companyId], references: [id], onDelete: Cascade)
  creator                             User                        @relation("JobCreator", fields: [createdBy], references: [id], onDelete: Cascade)
  region                              Region?                     @relation(fields: [regionId], references: [id])
  jobInvitations                      JobInvitation[]
  JobRound                            JobRound[]
  JobTemplate                         JobTemplate[]
  PreInterviewQuestionnaire           PreInterviewQuestionnaire[]
  savedJobs                           SavedJob[]
  ScreeningCriteria                   ScreeningCriteria[]

  @@index([companyId])
  @@index([createdBy])
  @@index([status])
  @@index([hiringMode])
  @@index([expiryDate])
  @@index([regionId])
  @@index([assigned_consultant_id])
  @@index([assignment_source])
}

model Candidate {
  id                String                    @id @default(uuid())
  email             String                    @unique
  passwordHash      String                    @map("password_hash")
  firstName         String                    @map("first_name")
  lastName          String                    @map("last_name")
  phone             String?
  photo             String?
  linkedInUrl       String?                   @map("linked_in_url")
  city              String?
  state             String?
  country           String?                   @default("United States")
  visaStatus        String?                   @map("visa_status")
  workEligibility   String?                   @map("work_eligibility")
  jobTypePreference String[]                  @default([]) @map("job_type_preference")
  salaryPreference  Json?                     @map("salary_preference")
  relocationWilling Boolean?                  @default(false) @map("relocation_willing")
  remotePreference  String?                   @map("remote_preference")
  emailVerified     Boolean                   @default(false) @map("email_verified")
  status            CandidateStatus           @default(ACTIVE)
  lastLoginAt       DateTime?                 @map("last_login_at")
  createdAt         DateTime                  @default(now()) @map("created_at")
  updatedAt         DateTime                  @updatedAt @map("updated_at")
  resumeUrl         String?                   @map("resume_url")
  applications      Application[]
  certifications    CandidateCertification[]
  education         CandidateEducation[]
  sessions          CandidateSession[]
  skills            CandidateSkill[]
  training          CandidateTraining[]
  workExperience    CandidateWorkExperience[]
  jobAlerts         JobAlert[]
  JobInvitation     JobInvitation[]
  notifications     Notification[]
  resumes           CandidateResume[]
  coverLetters      CandidateCoverLetter[]
  portfolioItems    CandidatePortfolio[]
  savedJobs         SavedJob[]
  savedSearches     SavedSearch[]

  @@index([email])
  @@index([status])
}

model CandidateWorkExperience {
  id          String    @id @default(uuid())
  candidateId String    @map("candidate_id")
  company     String
  role        String
  startDate   DateTime  @map("start_date")
  endDate     DateTime? @map("end_date")
  current     Boolean   @default(false)
  description String?
  location    String?
  createdAt   DateTime  @default(now()) @map("created_at")
  updatedAt   DateTime  @updatedAt @map("updated_at")
  candidate   Candidate @relation(fields: [candidateId], references: [id], onDelete: Cascade)

  @@index([candidateId])
}

model CandidateSkill {
  id          String    @id @default(uuid())
  candidateId String    @map("candidate_id")
  name        String
  level       String?
  createdAt   DateTime  @default(now()) @map("created_at")
  candidate   Candidate @relation(fields: [candidateId], references: [id], onDelete: Cascade)

  @@index([candidateId])
}

model CandidateEducation {
  id          String    @id @default(uuid())
  candidateId String    @map("candidate_id")
  institution String
  degree      String
  field       String
  startDate   DateTime? @map("start_date")
  endDate     DateTime? @map("end_date")
  current     Boolean   @default(false)
  grade       String?
  description String?
  createdAt   DateTime  @default(now()) @map("created_at")
  updatedAt   DateTime  @updatedAt @map("updated_at")
  candidate   Candidate @relation(fields: [candidateId], references: [id], onDelete: Cascade)

  @@index([candidateId])
}

model CandidateCertification {
  id            String    @id @default(uuid())
  candidateId   String    @map("candidate_id")
  name          String
  issuingOrg    String    @map("issuing_org")
  issueDate     DateTime? @map("issue_date")
  expiryDate    DateTime? @map("expiry_date")
  credentialId  String?   @map("credential_id")
  credentialUrl String?   @map("credential_url")
  doesNotExpire Boolean   @default(false) @map("does_not_expire")
  createdAt     DateTime  @default(now()) @map("created_at")
  updatedAt     DateTime  @updatedAt @map("updated_at")
  candidate     Candidate @relation(fields: [candidateId], references: [id], onDelete: Cascade)

  @@index([candidateId])
  @@index([expiryDate])
}

model CandidateTraining {
  id             String    @id @default(uuid())
  candidateId    String    @map("candidate_id")
  courseName     String    @map("course_name")
  provider       String
  completedDate  DateTime? @map("completed_date")
  duration       String?
  description    String?
  certificateUrl String?   @map("certificate_url")
  createdAt      DateTime  @default(now()) @map("created_at")
  updatedAt      DateTime  @updatedAt @map("updated_at")
  candidate      Candidate @relation(fields: [candidateId], references: [id], onDelete: Cascade)

  @@index([candidateId])
}

model CandidateSession {
  id           String    @id @default(uuid())
  sessionId    String    @unique @map("session_id")
  candidateId  String    @map("candidate_id")
  email        String
  expiresAt    DateTime  @map("expires_at")
  lastActivity DateTime  @default(now()) @map("last_activity")
  createdAt    DateTime  @default(now()) @map("created_at")
  candidate    Candidate @relation(fields: [candidateId], references: [id], onDelete: Cascade)

  @@index([sessionId])
  @@index([candidateId])
  @@index([expiresAt])
}

model SavedJob {
  id          String    @id @default(uuid())
  candidateId String    @map("candidate_id")
  jobId       String    @map("job_id")
  createdAt   DateTime  @default(now()) @map("created_at")
  candidate   Candidate @relation(fields: [candidateId], references: [id], onDelete: Cascade)
  job         Job       @relation(fields: [jobId], references: [id], onDelete: Cascade)

  @@unique([candidateId, jobId])
  @@index([candidateId])
  @@index([jobId])
}

model SavedSearch {
  id             String    @id @default(uuid())
  candidateId    String    @map("candidate_id")
  filters        Json
  createdAt      DateTime  @default(now()) @map("created_at")
  updatedAt      DateTime  @updatedAt @map("updated_at")
  lastSearchedAt DateTime  @default(now()) @map("last_searched_at")
  query          String?
  candidate      Candidate @relation(fields: [candidateId], references: [id], onDelete: Cascade)

  @@index([candidateId])
  @@index([lastSearchedAt])
}

model JobAlert {
  id          String    @id @default(uuid())
  candidateId String    @map("candidate_id")
  name        String
  criteria    Json
  frequency   String    @default("DAILY")
  channels    String[]  @default(["EMAIL"])
  isActive    Boolean   @default(true) @map("is_active")
  createdAt   DateTime  @default(now()) @map("created_at")
  updatedAt   DateTime  @updatedAt @map("updated_at")
  candidate   Candidate @relation(fields: [candidateId], references: [id], onDelete: Cascade)

  @@index([candidateId])
  @@index([isActive])
}

model Notification {
  id          String           @id @default(uuid())
  candidateId String           @map("candidate_id")
  type        NotificationType
  title       String
  message     String
  data        Json?
  read        Boolean          @default(false)
  readAt      DateTime?        @map("read_at")
  createdAt   DateTime         @default(now()) @map("created_at")
  candidate   Candidate        @relation(fields: [candidateId], references: [id], onDelete: Cascade)

  @@index([candidateId])
  @@index([read])
  @@index([createdAt])
}

model CandidateResume {
  id         String   @id @default(uuid())
  candidateId String  @map("candidate_id")
  fileName   String   @map("file_name")
  fileUrl    String   @map("file_url")
  fileSize   Int      @map("file_size")
  fileType   String   @map("file_type")
  isDefault  Boolean  @default(false) @map("is_default")
  version    Int      @default(1)
  uploadedAt DateTime @default(now()) @map("uploaded_at")
  candidate  Candidate @relation(fields: [candidateId], references: [id], onDelete: Cascade)

  @@index([candidateId])
  @@index([isDefault])
}

model CandidateCoverLetter {
  id         String   @id @default(uuid())
  candidateId String  @map("candidate_id")
  title      String
  content    String?  @db.Text
  fileUrl    String?  @map("file_url")
  fileName   String?  @map("file_name")
  fileSize   Int?     @map("file_size")
  fileType   String?  @map("file_type")
  isTemplate Boolean  @default(false) @map("is_template")
  isDraft    Boolean  @default(true) @map("is_draft")
  createdAt  DateTime @default(now()) @map("created_at")
  updatedAt  DateTime @updatedAt @map("updated_at")
  candidate  Candidate @relation(fields: [candidateId], references: [id], onDelete: Cascade)

  @@index([candidateId])
}

model CandidatePortfolio {
  id          String   @id @default(uuid())
  candidateId String   @map("candidate_id")
  title       String
  type        String   // 'file' or 'link'
  fileUrl     String?  @map("file_url")
  fileName    String?  @map("file_name")
  fileSize    Int?     @map("file_size")
  fileType    String?  @map("file_type")
  externalUrl String?  @map("external_url")
  platform    String?  // 'github', 'behance', 'dribbble', 'website', 'other'
  description String?  @db.Text
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")
  candidate   Candidate @relation(fields: [candidateId], references: [id], onDelete: Cascade)

  @@index([candidateId])
}

model Application {
  id                       String                     @id @default(uuid())
  candidateId              String                     @map("candidate_id")
  jobId                    String                     @map("job_id")
  status                   ApplicationStatus          @default(NEW)
  stage                    ApplicationStage           @default(NEW_APPLICATION)
  appliedDate              DateTime                   @default(now()) @map("applied_date")
  resumeUrl                String?                    @map("resume_url")
  coverLetterUrl           String?                    @map("cover_letter_url")
  portfolioUrl             String?                    @map("portfolio_url")
  linkedInUrl              String?                    @map("linked_in_url")
  websiteUrl               String?                    @map("website_url")
  customAnswers            Json?                      @map("custom_answers")
  questionnaireData        Json?                      @map("questionnaire_data")
  isRead                   Boolean                    @default(false) @map("is_read")
  isNew                    Boolean                    @default(true) @map("is_new")
  tags                     String[]                   @default([])
  createdAt                DateTime                   @default(now()) @map("created_at")
  updatedAt                DateTime                   @updatedAt @map("updated_at")
  addedAt                  DateTime?                  @map("added_at")
  addedBy                  String?                    @map("added_by")
  manuallyAdded            Boolean                    @default(false) @map("manually_added")
  rank                     Int?
  recruiterNotes           String?                    @map("recruiter_notes")
  score                    Float?
  shortlisted              Boolean                    @default(false)
  shortlistedAt            DateTime?                  @map("shortlisted_at")
  shortlistedBy            String?                    @map("shortlisted_by")
  assessmentResults        Json?                      @map("assessment_results")
  automatedScreeningScore  Float?                     @map("automated_screening_score")
  manualScreeningStatus    ManualScreeningStatus?     @map("manual_screening_status")
  screeningNotes           String?                    @map("screening_notes")
  screeningStatus          ScreeningStatus            @default(PENDING) @map("screening_status")
  videoInterviewStatus     VideoInterviewStatus       @default(NOT_SCHEDULED) @map("video_interview_status")
  manualScreeningCompleted Boolean                    @default(false) @map("manual_screening_completed")
  manualScreeningDate      DateTime?                  @map("manual_screening_date")
  manualScreeningScore     Float?                     @map("manual_screening_score")
  aiAnalysis               Json?                      @map("ai_analysis")
  candidate                Candidate                  @relation(fields: [candidateId], references: [id], onDelete: Cascade)
  job                      Job                        @relation(fields: [jobId], references: [id], onDelete: Cascade)
  ApplicationRoundProgress ApplicationRoundProgress[]
  Assessment               Assessment[]
  jobInvitation            JobInvitation?
  QuestionnaireResponse    QuestionnaireResponse[]
  ScreeningResult          ScreeningResult[]
  VideoInterview           VideoInterview[]

  @@unique([candidateId, jobId])
  @@index([candidateId])
  @@index([jobId])
  @@index([status])
  @@index([stage])
  @@index([appliedDate])
  @@index([score])
  @@index([shortlisted])
  @@index([screeningStatus])
}

model JobInvitation {
  id            String              @id @default(uuid())
  jobId         String              @map("job_id")
  candidateId   String?             @map("candidate_id")
  email         String
  token         String              @unique
  status        JobInvitationStatus @default(PENDING)
  invitedBy     String              @map("invited_by")
  expiresAt     DateTime            @map("expires_at")
  acceptedAt    DateTime?           @map("accepted_at")
  applicationId String?             @unique @map("application_id")
  createdAt     DateTime            @default(now()) @map("created_at")
  updatedAt     DateTime            @updatedAt @map("updated_at")
  application   Application?        @relation(fields: [applicationId], references: [id])
  candidate     Candidate?          @relation(fields: [candidateId], references: [id], onDelete: Cascade)
  inviter       User                @relation("JobInviter", fields: [invitedBy], references: [id], onDelete: Cascade)
  job           Job                 @relation(fields: [jobId], references: [id], onDelete: Cascade)

  @@unique([jobId, email])
  @@index([email])
  @@index([jobId])
  @@index([candidateId])
  @@index([token])
  @@index([status])
  @@index([expiresAt])
}

model JobTemplate {
  id            String           @id @default(dbgenerated("gen_random_uuid()"))
  company_id    String
  created_by    String
  name          String
  description   String?
  category      TemplateCategory @default(OTHER)
  is_shared     Boolean          @default(false)
  source_job_id String?
  job_data      Json
  usage_count   Int              @default(0)
  last_used_at  DateTime?
  created_at    DateTime         @default(now())
  updated_at    DateTime         @default(now())
  Company       Company          @relation(fields: [company_id], references: [id], onDelete: Cascade)
  User          User             @relation(fields: [created_by], references: [id], onDelete: Cascade)
  Job           Job?             @relation(fields: [source_job_id], references: [id])

  @@index([category])
  @@index([company_id])
  @@index([created_by])
  @@index([is_shared])
  @@index([source_job_id])
}

model Assessment {
  id                 String               @id
  application_id     String
  candidate_id       String
  job_id             String
  assessment_type    AssessmentType
  provider           String?
  status             AssessmentStatus     @default(PENDING_INVITATION)
  invited_by         String
  invited_at         DateTime             @default(now())
  expiry_date        DateTime?
  completed_at       DateTime?
  results            Json?
  pass_threshold     Float?
  cost               Float?               @default(0)
  payment_status     String?              @default("pending")
  notes              String?
  created_at         DateTime             @default(now())
  updated_at         DateTime
  invitation_token   String?              @unique
  job_round_id       String?
  Application        Application          @relation(fields: [application_id], references: [id], onDelete: Cascade)
  User               User                 @relation(fields: [invited_by], references: [id])
  AssessmentQuestion AssessmentQuestion[]
  AssessmentResponse AssessmentResponse[]

  @@index([application_id])
  @@index([assessment_type])
  @@index([candidate_id])
  @@index([job_id])
  @@index([status])
  @@index([invitation_token])
  @@index([job_round_id])
}

model AssessmentQuestion {
  id                 String               @id
  assessment_id      String
  question_text      String
  question_type      String
  options            Json?
  correct_answer     Json?
  points             Int                  @default(1)
  order              Int                  @default(0)
  created_at         DateTime             @default(now())
  Assessment         Assessment           @relation(fields: [assessment_id], references: [id], onDelete: Cascade)
  AssessmentResponse AssessmentResponse[]

  @@index([assessment_id])
  @@index([order])
}

model AssessmentResponse {
  id                 String              @id
  assessment_id      String
  question_id        String?
  candidate_id       String
  response           Json
  score              Float?
  answered_at        DateTime            @default(now())
  Assessment         Assessment          @relation(fields: [assessment_id], references: [id], onDelete: Cascade)
  AssessmentQuestion AssessmentQuestion? @relation(fields: [question_id], references: [id])

  @@index([assessment_id])
  @@index([candidate_id])
  @@index([question_id])
}

model Commission {
  id               String           @id @default(uuid())
  consultantId     String           @map("consultant_id")
  regionId         String           @map("region_id")
  jobId            String?          @map("job_id")
  type             CommissionType
  amount           Float
  rate             Float?
  description      String?
  status           CommissionStatus @default(PENDING)
  confirmedAt      DateTime?        @map("confirmed_at")
  paidAt           DateTime?        @map("paid_at")
  paymentReference String?          @map("payment_reference")
  notes            String?
  createdAt        DateTime         @default(now()) @map("created_at")
  updatedAt        DateTime         @updatedAt @map("updated_at")
  consultant       Consultant       @relation(fields: [consultantId], references: [id])
  job              Job?             @relation(fields: [jobId], references: [id])
  region           Region           @relation(fields: [regionId], references: [id])

  @@index([consultantId])
  @@index([jobId])
  @@index([regionId])
  @@index([status])
  @@index([type])
}

model Consultant {
  id                    String                    @id @default(uuid())
  email                 String                    @unique
  passwordHash          String                    @map("password_hash")
  firstName             String                    @map("first_name")
  lastName              String                    @map("last_name")
  phone                 String?
  photo                 String?
  role                  ConsultantRole
  status                ConsultantStatus          @default(ACTIVE)
  createdAt             DateTime                  @default(now()) @map("created_at")
  updatedAt             DateTime                  @updatedAt @map("updated_at")
  lastLoginAt           DateTime?                 @map("last_login_at")
  address               String?
  availability          AvailabilityStatus        @default(AVAILABLE)
  averageDaysToFill     Float?                    @map("average_days_to_fill")
  city                  String?
  commissionStructure   String?                   @map("commission_structure")
  country               String?
  currentEmployers      Int                       @default(0) @map("current_employers")
  currentJobs           Int                       @default(0) @map("current_jobs")
  defaultCommissionRate Float?                    @map("default_commission_rate")
  industryExpertise     String[]                  @default([]) @map("industry_expertise")
  languages             Json?
  maxEmployers          Int                       @default(10) @map("max_employers")
  maxJobs               Int                       @default(20) @map("max_jobs")
  paymentMethod         Json?                     @map("payment_method")
  pendingCommissions    Float                     @default(0) @map("pending_commissions")
  regionId              String                    @map("region_id")
  resumeUrl             String?                   @map("resume_url")
  stateProvince         String?                   @map("state_province")
  successRate           Float                     @default(0) @map("success_rate")
  taxInformation        Json?                     @map("tax_information")
  totalCommissionsPaid  Float                     @default(0) @map("total_commissions_paid")
  totalPlacements       Int                       @default(0) @map("total_placements")
  totalRevenue          Float                     @default(0) @map("total_revenue")
  commissions           Commission[]
  region                Region                    @relation(fields: [regionId], references: [id])
  jobAssignments        ConsultantJobAssignment[]
  sessions              ConsultantSession[]
  Job                   Job[]

  @@index([email])
  @@index([regionId])
  @@index([role])
  @@index([status])
  @@index([availability, status, regionId])
}

model ConsultantJobAssignment {
  id                String            @id @default(uuid())
  consultantId      String            @map("consultant_id")
  jobId             String            @map("job_id")
  assignedAt        DateTime          @default(now()) @map("assigned_at")
  assignedBy        String?           @map("assigned_by")
  status            String            @default("ACTIVE")
  notes             String?
  assignment_source AssignmentSource?
  consultant        Consultant        @relation(fields: [consultantId], references: [id], onDelete: Cascade)
  job               Job               @relation(fields: [jobId], references: [id], onDelete: Cascade)

  @@unique([consultantId, jobId])
  @@index([consultantId])
  @@index([jobId])
  @@index([status])
}

model ConsultantSession {
  id           String     @id @default(uuid())
  sessionId    String     @unique @map("session_id")
  consultantId String     @map("consultant_id")
  email        String
  expiresAt    DateTime   @map("expires_at")
  lastActivity DateTime   @default(now()) @map("last_activity")
  createdAt    DateTime   @default(now()) @map("created_at")
  consultant   Consultant @relation(fields: [consultantId], references: [id], onDelete: Cascade)

  @@index([consultantId])
  @@index([expiresAt])
  @@index([sessionId])
}

model HRM8Session {
  id           String   @id @default(uuid())
  sessionId    String   @unique @map("session_id")
  hrm8UserId   String   @map("hrm8_user_id")
  email        String
  expiresAt    DateTime @map("expires_at")
  lastActivity DateTime @default(now()) @map("last_activity")
  createdAt    DateTime @default(now()) @map("created_at")
  user         HRM8User @relation(fields: [hrm8UserId], references: [id], onDelete: Cascade)

  @@index([expiresAt])
  @@index([hrm8UserId])
  @@index([sessionId])
}

model HRM8User {
  id           String         @id @default(uuid())
  email        String         @unique
  passwordHash String         @map("password_hash")
  firstName    String         @map("first_name")
  lastName     String         @map("last_name")
  phone        String?
  photo        String?
  role         HRM8UserRole
  status       HRM8UserStatus @default(ACTIVE)
  licenseeId   String?        @map("licensee_id")
  createdAt    DateTime       @default(now()) @map("created_at")
  updatedAt    DateTime       @updatedAt @map("updated_at")
  lastLoginAt  DateTime?      @map("last_login_at")
  sessions     HRM8Session[]

  @@index([email])
  @@index([licenseeId])
  @@index([role])
  @@index([status])
}

model PreInterviewQuestionnaire {
  id                    String                  @id
  job_id                String
  questions             Json
  auto_generated        Boolean                 @default(false)
  generated_by          String?
  enabled               Boolean                 @default(true)
  created_at            DateTime                @default(now())
  updated_at            DateTime
  Job                   Job                     @relation(fields: [job_id], references: [id], onDelete: Cascade)
  QuestionnaireResponse QuestionnaireResponse[]

  @@index([job_id])
}

model QuestionnaireResponse {
  id                        String                    @id
  questionnaire_id          String
  application_id            String
  candidate_id              String
  responses                 Json
  submitted_at              DateTime                  @default(now())
  score                     Float?
  Application               Application               @relation(fields: [application_id], references: [id], onDelete: Cascade)
  PreInterviewQuestionnaire PreInterviewQuestionnaire @relation(fields: [questionnaire_id], references: [id], onDelete: Cascade)

  @@index([application_id])
  @@index([candidate_id])
  @@index([questionnaire_id])
}

model Region {
  id            String            @id @default(uuid())
  name          String
  code          String            @unique
  country       String
  stateProvince String?           @map("state_province")
  city          String?
  boundaries    Json?
  ownerType     RegionOwnerType   @default(HRM8) @map("owner_type")
  licenseeId    String?           @map("licensee_id")
  isActive      Boolean           @default(true) @map("is_active")
  createdAt     DateTime          @default(now()) @map("created_at")
  updatedAt     DateTime          @updatedAt @map("updated_at")
  commissions   Commission[]
  companies     Company[]
  consultants   Consultant[]
  jobs          Job[]
  licensee      RegionalLicensee? @relation(fields: [licenseeId], references: [id])
  revenue       RegionalRevenue[]

  @@index([isActive])
  @@index([licenseeId])
  @@index([ownerType])
}

model RegionalLicensee {
  id                  String            @id @default(uuid())
  name                String
  legalEntityName     String            @map("legal_entity_name")
  email               String
  phone               String?
  address             String?
  city                String?
  state               String?
  country             String?
  taxId               String?           @map("tax_id")
  agreementStartDate  DateTime          @map("agreement_start_date")
  agreementEndDate    DateTime?         @map("agreement_end_date")
  revenueSharePercent Float             @map("revenue_share_percent")
  exclusivity         Boolean           @default(false)
  contractFileUrl     String?           @map("contract_file_url")
  managerContact      String            @map("manager_contact")
  financeContact      String?           @map("finance_contact")
  complianceContact   String?           @map("compliance_contact")
  status              LicenseeStatus    @default(ACTIVE)
  createdAt           DateTime          @default(now()) @map("created_at")
  updatedAt           DateTime          @updatedAt @map("updated_at")
  regions             Region[]
  revenueShares       RegionalRevenue[]

  @@index([email])
  @@index([status])
}

model RegionalRevenue {
  id            String            @id @default(uuid())
  regionId      String            @map("region_id")
  licenseeId    String?           @map("licensee_id")
  periodStart   DateTime          @map("period_start")
  periodEnd     DateTime          @map("period_end")
  totalRevenue  Float             @map("total_revenue")
  licenseeShare Float             @map("licensee_share")
  hrm8Share     Float             @map("hrm8_share")
  status        RevenueStatus     @default(PENDING)
  paidAt        DateTime?         @map("paid_at")
  createdAt     DateTime          @default(now()) @map("created_at")
  updatedAt     DateTime          @updatedAt @map("updated_at")
  licensee      RegionalLicensee? @relation(fields: [licenseeId], references: [id])
  region        Region            @relation(fields: [regionId], references: [id])

  @@index([licenseeId])
  @@index([regionId])
  @@index([status])
}

model ScreeningCriteria {
  id              String            @id
  job_id          String
  criteria_type   String
  criteria_config Json?
  enabled         Boolean           @default(true)
  created_at      DateTime          @default(now())
  updated_at      DateTime
  category        String?
  description     String?
  min_score       Int?
  name            String
  required        Boolean           @default(false)
  weight          Float?
  Job             Job               @relation(fields: [job_id], references: [id], onDelete: Cascade)
  ScreeningResult ScreeningResult[]

  @@index([category])
  @@index([criteria_type])
  @@index([job_id])
}

model ScreeningResult {
  id                String                @id
  application_id    String
  screening_type    ScreeningType
  status            ScreeningResultStatus @default(PENDING)
  score             Float?
  criteria_matched  Json?
  reviewed_by       String?
  reviewed_at       DateTime?
  notes             String?
  created_at        DateTime              @default(now())
  updated_at        DateTime
  criteria_id       String?
  passed            Boolean?
  Application       Application           @relation(fields: [application_id], references: [id], onDelete: Cascade)
  ScreeningCriteria ScreeningCriteria?    @relation(fields: [criteria_id], references: [id], onDelete: Cascade)
  User              User?                 @relation(fields: [reviewed_by], references: [id])

  @@unique([application_id, criteria_id])
  @@index([application_id])
  @@index([criteria_id])
  @@index([screening_type])
  @@index([status])
}

model VideoInterview {
  id             String             @id @default(uuid())
  applicationId  String             @map("application_id")
  candidateId    String             @map("candidate_id")
  jobId          String             @map("job_id")
  scheduledDate  DateTime           @map("scheduled_date")
  duration       Int                @default(60)
  meetingLink    String?            @map("meeting_link")
  status         InterviewStatus    @default(SCHEDULED)
  type           VideoInterviewType @default(VIDEO)
  interviewerIds Json               @map("interviewer_ids")
  recordingUrl   String?            @map("recording_url")
  transcript     Json?
  feedback       Json?
  notes          String?
  createdAt      DateTime           @default(now()) @map("created_at")
  updatedAt      DateTime           @updatedAt @map("updated_at")
  Application    Application        @relation(fields: [applicationId], references: [id], onDelete: Cascade)

  @@index([applicationId])
  @@index([candidateId])
  @@index([jobId])
  @@index([scheduledDate])
  @@index([status])
}

model ApplicationRoundProgress {
  id                 String      @id
  application_id     String
  job_round_id       String
  completed          Boolean     @default(false)
  completed_at       DateTime?
  assessment_id      String?
  video_interview_id String?
  created_at         DateTime    @default(now())
  updated_at         DateTime
  Application        Application @relation(fields: [application_id], references: [id], onDelete: Cascade)
  JobRound           JobRound    @relation(fields: [job_round_id], references: [id], onDelete: Cascade)

  @@unique([application_id, job_round_id])
  @@index([application_id])
  @@index([job_round_id])
}

model CompanySettings {
  id         String   @id
  company_id String   @unique
  timezone   String?  @default("UTC")
  workDays   String[] @default(["monday", "tuesday", "wednesday", "thursday", "friday"])
  startTime  String?  @default("09:00")
  endTime    String?  @default("17:00")
  lunchStart String?
  lunchEnd   String?
  created_at DateTime @default(now())
  updated_at DateTime
  Company    Company  @relation(fields: [company_id], references: [id], onDelete: Cascade)

  @@index([company_id])
}

model JobRound {
  id                       String                     @id
  job_id                   String
  name                     String
  order                    Int
  type                     JobRoundType
  isFixed                  Boolean                    @default(false)
  fixedKey                 String?
  created_at               DateTime                   @default(now())
  updated_at               DateTime
  ApplicationRoundProgress ApplicationRoundProgress[]
  AssessmentConfiguration  AssessmentConfiguration?
  Job                      Job                        @relation(fields: [job_id], references: [id], onDelete: Cascade)

  @@index([isFixed])
  @@index([job_id])
  @@index([order])
}

model AssessmentConfiguration {
  id                     String   @id
  job_round_id           String   @unique @map("job_round_id")
  enabled                Boolean  @default(false)
  autoAssign             Boolean  @default(true)
  deadline_days          Int?     @map("deadline_days")
  time_limit_minutes     Int?     @map("time_limit_minutes")
  pass_threshold         Float?   @map("pass_threshold")
  provider               String?
  provider_config        Json?    @map("provider_config")
  assessment_template_id String?  @map("assessment_template_id")
  questions              Json?
  instructions           String?
  created_at             DateTime @default(now()) @map("created_at")
  updated_at             DateTime @updatedAt @map("updated_at")
  JobRound               JobRound @relation(fields: [job_round_id], references: [id], onDelete: Cascade)

  @@index([job_round_id])
  @@index([provider])
}

enum UserRole {
  SUPER_ADMIN
  ADMIN
  USER
  VISITOR
}

enum UserStatus {
  ACTIVE
  INACTIVE
  PENDING_VERIFICATION
  INVITED
}

enum CompanyVerificationStatus {
  PENDING
  VERIFIED
  REJECTED
}

enum CompanyProfileStatus {
  NOT_STARTED
  IN_PROGRESS
  COMPLETED
}

enum CompanyProfileSection {
  BASIC_DETAILS
  PRIMARY_LOCATION
  PERSONAL_PROFILE
  TEAM_MEMBERS
  BILLING
  BRANDING
}

enum VerificationMethod {
  EMAIL_DOMAIN_CHECK
  VERIFICATION_EMAIL
  MANUAL_VERIFICATION
}

enum InvitationStatus {
  PENDING
  ACCEPTED
  EXPIRED
  CANCELLED
}

enum JobInvitationStatus {
  PENDING
  ACCEPTED
  EXPIRED
  CANCELLED
}

enum SignupRequestStatus {
  PENDING
  APPROVED
  REJECTED
}

enum JobStatus {
  DRAFT
  OPEN
  CLOSED
  ON_HOLD
  FILLED
  TEMPLATE
  CANCELLED
}

enum HiringMode {
  SELF_MANAGED
  SHORTLISTING
  FULL_SERVICE
  EXECUTIVE_SEARCH
}

enum WorkArrangement {
  ON_SITE
  REMOTE
  HYBRID
}

enum EmploymentType {
  FULL_TIME
  PART_TIME
  CONTRACT
  CASUAL
}

enum TemplateCategory {
  ENGINEERING
  PRODUCT
  DESIGN
  MARKETING
  SALES
  OPERATIONS
  HR
  FINANCE
  EXECUTIVE
  OTHER
}

enum CandidateStatus {
  ACTIVE
  INACTIVE
  PENDING_VERIFICATION
}

enum ApplicationStatus {
  NEW
  SCREENING
  INTERVIEW
  OFFER
  HIRED
  REJECTED
  WITHDRAWN
}

enum ApplicationStage {
  NEW_APPLICATION
  RESUME_REVIEW
  PHONE_SCREEN
  TECHNICAL_INTERVIEW
  ONSITE_INTERVIEW
  OFFER_EXTENDED
  OFFER_ACCEPTED
  REJECTED
}

enum AssessmentStatus {
  PENDING_INVITATION
  INVITED
  IN_PROGRESS
  COMPLETED
  EXPIRED
  CANCELLED
}

enum AssessmentType {
  PERSONALITY
  COGNITIVE
  SKILLS_BASED
  TECHNICAL
  BEHAVIORAL
}

enum AvailabilityStatus {
  AVAILABLE
  AT_CAPACITY
  UNAVAILABLE
}

enum CommissionStatus {
  PENDING
  CONFIRMED
  PAID
  CANCELLED
}

enum CommissionType {
  PLACEMENT
  SUBSCRIPTION_SALE
  RECRUITMENT_SERVICE
  CUSTOM
}

enum ConsultantRole {
  RECRUITER
  SALES_AGENT
  CONSULTANT_360
}

enum ConsultantStatus {
  ACTIVE
  ON_LEAVE
  INACTIVE
  SUSPENDED
}

enum HRM8UserRole {
  GLOBAL_ADMIN
  REGIONAL_LICENSEE
}

enum HRM8UserStatus {
  ACTIVE
  SUSPENDED
  TERMINATED
}

enum InterviewStatus {
  SCHEDULED
  IN_PROGRESS
  COMPLETED
  CANCELLED
  RESCHEDULED
  NO_SHOW
}

enum LicenseeStatus {
  ACTIVE
  SUSPENDED
  TERMINATED
}

enum ManualScreeningStatus {
  PENDING
  PASSED
  FAILED
}

enum RegionOwnerType {
  HRM8
  LICENSEE
}

enum RevenueStatus {
  PENDING
  CONFIRMED
  PAID
}

enum ScreeningResultStatus {
  PASSED
  FAILED
  PENDING
  REVIEW_REQUIRED
}

enum ScreeningStatus {
  PENDING
  IN_PROGRESS
  COMPLETED
}

enum ScreeningType {
  AUTOMATED
  MANUAL
}

enum VideoInterviewStatus {
  NOT_SCHEDULED
  SCHEDULED
  IN_PROGRESS
  COMPLETED
  CANCELLED
  RESCHEDULED
}

enum VideoInterviewType {
  PHONE
  VIDEO
  IN_PERSON
  TECHNICAL
  PANEL
}

enum JobRoundType {
  ASSESSMENT
  INTERVIEW
}

enum NotificationType {
  JOB_ALERT
  APPLICATION_UPDATE
  INTERVIEW_SCHEDULED
  MESSAGE
  SYSTEM
}

enum AssignmentMode {
  AUTO
  MANUAL
}

enum AssignmentSource {
  AUTO_RULES
  MANUAL_EMPLOYER
  MANUAL_LICENSEE
  MANUAL_HRM8
}

enum JobAssignmentMode {
  AUTO_RULES_ONLY
  MANUAL_ONLY
}
