generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Company {
  id                 String                    @id @default(uuid())
  name               String
  website            String
  domain             String                    @unique
  countryOrRegion    String                    @default("") @map("country_or_region")
  acceptedTerms      Boolean                   @default(false) @map("accepted_terms")
  verificationStatus CompanyVerificationStatus @default(PENDING)
  verificationMethod VerificationMethod?
  verifiedAt         DateTime?
  verifiedBy         String?
  gstNumber          String?
  registrationNumber String?
  linkedInUrl        String?
  createdAt          DateTime                  @default(now())
  updatedAt          DateTime                  @updatedAt
  profile            CompanyProfile?
  invitations        Invitation[]
  jobs               Job[]
  jobTemplates       JobTemplate[]
  signupRequests     SignupRequest[]
  users              User[]
  verificationTokens VerificationToken[]

  @@index([domain])
  @@index([verificationStatus])
}

model CompanyProfile {
  id                   String                  @id @default(uuid())
  companyId            String                  @unique @map("company_id")
  status               CompanyProfileStatus    @default(NOT_STARTED)
  completionPercentage Int                     @default(0) @map("completion_percentage")
  completedSections    CompanyProfileSection[] @default([]) @map("completed_sections")
  profileData          Json?                   @map("profile_data")
  lastReminderAt       DateTime?               @map("last_reminder_at")
  skipUntil            DateTime?               @map("skip_until")
  createdAt            DateTime                @default(now()) @map("created_at")
  updatedAt            DateTime                @updatedAt @map("updated_at")
  company              Company                 @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([companyId])
}

model User {
  id                     String          @id @default(uuid())
  email                  String          @unique
  name                   String
  passwordHash           String          @map("password_hash")
  companyId              String          @map("company_id")
  role                   UserRole
  status                 UserStatus      @default(PENDING_VERIFICATION)
  lastLoginAt            DateTime?       @map("last_login_at")
  createdAt              DateTime        @default(now()) @map("created_at")
  updatedAt              DateTime        @updatedAt @map("updated_at")
  assignedBy             String?         @map("assigned_by")
  sentInvitations        Invitation[]    @relation("InvitedBy")
  createdJobs            Job[]           @relation("JobCreator")
  createdTemplates       JobTemplate[]   @relation("TemplateCreator")
  sessions               Session[]
  reviewedSignupRequests SignupRequest[] @relation("ReviewedBy")
  roleAssigner           User?           @relation("RoleAssigner", fields: [assignedBy], references: [id])
  assignedUsers          User[]          @relation("RoleAssigner")
  company                Company         @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([email])
  @@index([companyId])
  @@index([status])
  @@index([role])
}

model Invitation {
  id         String           @id @default(uuid())
  companyId  String           @map("company_id")
  invitedBy  String           @map("invited_by")
  email      String
  token      String           @unique
  status     InvitationStatus @default(PENDING)
  expiresAt  DateTime         @map("expires_at")
  acceptedAt DateTime?        @map("accepted_at")
  createdAt  DateTime         @default(now()) @map("created_at")
  company    Company          @relation(fields: [companyId], references: [id], onDelete: Cascade)
  inviter    User             @relation("InvitedBy", fields: [invitedBy], references: [id], onDelete: Cascade)

  @@index([email])
  @@index([companyId])
  @@index([token])
  @@index([status])
  @@index([expiresAt])
}

model Session {
  id           String   @id @default(uuid())
  sessionId    String   @unique @map("session_id")
  userId       String   @map("user_id")
  companyId    String   @map("company_id")
  userRole     UserRole @map("user_role")
  email        String
  expiresAt    DateTime @map("expires_at")
  lastActivity DateTime @default(now()) @map("last_activity")
  createdAt    DateTime @default(now()) @map("created_at")
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([sessionId])
  @@index([userId])
  @@index([companyId])
  @@index([expiresAt])
}

model VerificationToken {
  id        String    @id @default(uuid())
  companyId String    @map("company_id")
  email     String
  token     String    @unique
  expiresAt DateTime  @map("expires_at")
  usedAt    DateTime? @map("used_at")
  createdAt DateTime  @default(now()) @map("created_at")
  company   Company   @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@index([email])
  @@index([token])
  @@index([expiresAt])
}

model SignupRequest {
  id              String              @id @default(uuid())
  companyId       String              @map("company_id")
  email           String
  name            String
  firstName       String              @default("") @map("first_name")
  lastName        String              @default("") @map("last_name")
  acceptedTerms   Boolean             @default(false) @map("accepted_terms")
  passwordHash    String              @map("password_hash")
  status          SignupRequestStatus @default(PENDING)
  reviewedBy      String?             @map("reviewed_by")
  reviewedAt      DateTime?           @map("reviewed_at")
  rejectionReason String?             @map("rejection_reason")
  createdAt       DateTime            @default(now()) @map("created_at")
  updatedAt       DateTime            @updatedAt @map("updated_at")
  company         Company             @relation(fields: [companyId], references: [id], onDelete: Cascade)
  reviewer        User?               @relation("ReviewedBy", fields: [reviewedBy], references: [id])

  @@index([email])
  @@index([companyId])
  @@index([status])
  @@index([createdAt])
}

model Job {
  id                       String          @id @default(uuid())
  companyId                String          @map("company_id")
  createdBy                String          @map("created_by")
  title                    String
  jobCode                  String?         @map("job_code")
  jobSummary               String?         @map("job_summary") @db.VarChar(150)
  category                 String?
  numberOfVacancies        Int             @default(1) @map("number_of_vacancies")
  department               String?
  location                 String
  employmentType           EmploymentType  @default(FULL_TIME) @map("employment_type")
  workArrangement          WorkArrangement @default(ON_SITE) @map("work_arrangement")
  salaryMin                Float?          @map("salary_min")
  salaryMax                Float?          @map("salary_max")
  salaryCurrency           String          @default("USD") @map("salary_currency")
  salaryDescription        String?         @map("salary_description")
  description              String
  status                   JobStatus       @default(DRAFT)
  stealth                  Boolean         @default(false)
  postingDate              DateTime?       @map("posting_date")
  closeDate                DateTime?       @map("close_date")
  createdAt                DateTime        @default(now()) @map("created_at")
  updatedAt                DateTime        @updatedAt @map("updated_at")
  expiryDate               DateTime?       @map("expiry_date")
  featured                 Boolean         @default(false)
  hiringMode               HiringMode      @default(SELF_MANAGED) @map("hiring_mode")
  promotionalTags          String[]        @default([]) @map("promotional_tags")
  visibility               String          @default("public")
  requirements             String[]        @default([])
  responsibilities         String[]        @default([])
  termsAccepted            Boolean         @default(false) @map("terms_accepted")
  termsAcceptedAt          DateTime?       @map("terms_accepted_at")
  termsAcceptedBy          String?         @map("terms_accepted_by")
  hiringTeam               Json?           @map("hiring_team")
  applicationForm          Json?           @map("application_form")
  videoInterviewingEnabled Boolean         @default(false) @map("video_interviewing_enabled")
  alertsEnabled            Json?           @map("alerts_enabled")
  jobTargetApproved        Boolean         @default(false) @map("jobtarget_approved")
  jobTargetBudget          Float?          @map("jobtarget_budget")
  jobTargetBudgetSpent     Float?          @default(0) @map("jobtarget_budget_spent")
  jobTargetChannels        String[]        @default([]) @map("jobtarget_channels")
  jobTargetPromotionId     String?         @map("jobtarget_promotion_id")
  jobTargetStatus          String?         @map("jobtarget_status")
  referralLink             String?         @map("referral_link")
  savedAsTemplate          Boolean         @default(false) @map("saved_as_template")
  shareLink                String?         @map("share_link")
  templateId               String?         @map("template_id")
  archived                 Boolean         @default(false) @map("archived")
  archivedAt               DateTime?       @map("archived_at")
  archivedBy               String?         @map("archived_by")
  company                  Company         @relation(fields: [companyId], references: [id], onDelete: Cascade)
  creator                  User            @relation("JobCreator", fields: [createdBy], references: [id], onDelete: Cascade)
  JobTemplate              JobTemplate[]

  @@index([companyId])
  @@index([createdBy])
  @@index([status])
  @@index([hiringMode])
  @@index([expiryDate])
}

model JobTemplate {
  id            String           @id @default(dbgenerated("gen_random_uuid()"))
  companyId     String           @map("company_id")
  createdBy     String           @map("created_by")
  name          String
  description   String?
  category      TemplateCategory @default(OTHER)
  is_shared     Boolean          @default(false)
  source_job_id String?
  job_data      Json
  usageCount    Int              @default(0) @map("usage_count")
  lastUsedAt    DateTime?        @map("last_used_at")
  createdAt     DateTime         @default(now()) @map("created_at")
  updatedAt     DateTime         @default(now()) @updatedAt @map("updated_at")
  company       Company          @relation(fields: [companyId], references: [id], onDelete: Cascade)
  creator       User             @relation("TemplateCreator", fields: [createdBy], references: [id], onDelete: Cascade)
  Job           Job?             @relation(fields: [source_job_id], references: [id])

  @@index([companyId])
  @@index([createdBy])
  @@index([category])
  @@index([is_shared])
  @@index([source_job_id])
}

enum UserRole {
  SUPER_ADMIN
  ADMIN
  USER
  VISITOR
}

enum UserStatus {
  ACTIVE
  INACTIVE
  PENDING_VERIFICATION
  INVITED
}

enum CompanyVerificationStatus {
  PENDING
  VERIFIED
  REJECTED
}

enum CompanyProfileStatus {
  NOT_STARTED
  IN_PROGRESS
  COMPLETED
}

enum CompanyProfileSection {
  BASIC_DETAILS
  PRIMARY_LOCATION
  PERSONAL_PROFILE
  TEAM_MEMBERS
  BILLING
  BRANDING
}

enum VerificationMethod {
  EMAIL_DOMAIN_CHECK
  VERIFICATION_EMAIL
  MANUAL_VERIFICATION
}

enum InvitationStatus {
  PENDING
  ACCEPTED
  EXPIRED
  CANCELLED
}

enum SignupRequestStatus {
  PENDING
  APPROVED
  REJECTED
}

enum JobStatus {
  DRAFT
  OPEN
  CLOSED
  ON_HOLD
  FILLED
  TEMPLATE
  CANCELLED
}

enum HiringMode {
  SELF_MANAGED
  SHORTLISTING
  FULL_SERVICE
  EXECUTIVE_SEARCH
}

enum WorkArrangement {
  ON_SITE
  REMOTE
  HYBRID
}

enum EmploymentType {
  FULL_TIME
  PART_TIME
  CONTRACT
  CASUAL
}

enum TemplateCategory {
  ENGINEERING
  PRODUCT
  DESIGN
  MARKETING
  SALES
  OPERATIONS
  HR
  FINANCE
  EXECUTIVE
  OTHER
}
